<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Sopa de Letras</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: #0f172a;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #1e293b;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid #334155;
        }

        .header {
            background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
            color: white;
            padding: 32px 40px;
            border-bottom: 1px solid #334155;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .header p {
            font-size: 0.95em;
            opacity: 0.85;
            font-weight: 400;
        }

        .content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            padding: 30px;
        }

        .controls {
            background: #0f172a;
            padding: 24px;
            border-radius: 8px;
            height: fit-content;
            border: 1px solid #334155;
        }

        .control-group {
            margin-bottom: 24px;
        }

        .control-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-size: 0.875em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .control-group input[type="number"],
        .control-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #334155;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.2s;
            background: #1e293b;
            color: #e2e8f0;
        }

        .control-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .control-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #334155;
            border-radius: 6px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            min-height: 200px;
            transition: all 0.2s;
            background: #1e293b;
            color: #e2e8f0;
        }

        .control-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .word-count {
            text-align: right;
            font-size: 0.8em;
            color: #94a3b8;
            margin-top: 6px;
            font-weight: 500;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover {
            background: #334155;
            transform: translateY(-1px);
        }

        .btn-download {
            background: #10b981;
            color: white;
        }

        .btn-download:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .display-area {
            background: #0f172a;
            border-radius: 8px;
            padding: 24px;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #334155;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            transition: all 0.2s;
            color: #94a3b8;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.05em;
        }

        .tab:hover {
            background: #334155;
            color: #e2e8f0;
        }

        .tab.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        canvas {
            border: 1px solid #334155;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            max-width: 100%;
            height: auto;
            background: white;
        }

        .empty-state {
            text-align: center;
            color: #64748b;
        }

        .empty-state h3 {
            font-size: 1.25em;
            margin-bottom: 10px;
            font-weight: 500;
            color: #94a3b8;
        }

        .empty-state p {
            font-size: 0.95em;
        }

        .info-box {
            background: #1e293b;
            border-left: 3px solid #3b82f6;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 0.85em;
            line-height: 1.6;
            color: #cbd5e1;
        }

        .success-message {
            background: #064e3b;
            border-left: 3px solid #10b981;
            color: #d1fae5;
            padding: 14px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .warning-message {
            background: #451a03;
            border-left: 3px solid #f59e0b;
            color: #fed7aa;
            padding: 14px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Generador de Sopa de Letras</h1>
            <p>Herramienta profesional para crear sopas de letras con solución incluida</p>
        </div>

        <div class="content">
            <div class="controls">
                <div class="info-box">
                    <strong>Nota:</strong> Las grillas más grandes permiten palabras más largas. El tamaño se ajusta automáticamente si es necesario.
                </div>

                <div class="control-group">
                    <label>Tamaño de Grilla (10-30)</label>
                    <input type="number" id="gridSize" min="10" max="30" value="20">
                </div>

                <div class="control-group">
                    <label>Lista de Palabras</label>
                    <textarea id="wordList" placeholder="Ingrese una palabra por línea">PYTHON
PROGRAMAR
DESARROLLO
INTELIGENCIA
TECNOLOGIA
ALGORITMO
APLICACION
INNOVACION
DIGITAL
SISTEMA</textarea>
                    <div class="word-count" id="wordCount">10 palabras</div>
                </div>

                <button class="btn btn-primary" id="generateBtn">
                    Generar Sopa de Letras
                </button>

                <button class="btn btn-secondary" id="clearBtn">
                    Limpiar Todo
                </button>

                <div id="messageBox"></div>
            </div>

            <div class="display-area">
                <div class="tabs">
                    <div class="tab active" data-tab="puzzle">Puzzle</div>
                    <div class="tab" data-tab="solution">Solución</div>
                </div>

                <div id="canvasContainer">
                    <div class="empty-state">
                        <h3>Configure y genere su sopa de letras</h3>
                        <p>Las imágenes aparecerán aquí y podrá descargarlas</p>
                    </div>
                </div>

                <div id="downloadButtons" style="display: none; margin-top: 20px; width: 100%;">
                    <button class="btn btn-download" id="downloadPuzzle">
                        Descargar Puzzle
                    </button>
                    <button class="btn btn-download" id="downloadSolution">
                        Descargar Solución
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class WordSearchGenerator {
            constructor(size) {
                this.size = size;
                this.grid = [];
                this.placedWords = [];
                this.directions = [
                    [0, 1],   // horizontal derecha
                    [1, 0],   // vertical abajo
                    [1, 1],   // diagonal derecha-abajo
                    [0, -1],  // horizontal izquierda
                    [-1, 0],  // vertical arriba
                    [-1, -1], // diagonal izquierda-arriba
                    [1, -1],  // diagonal izquierda-abajo
                    [-1, 1]   // diagonal derecha-arriba
                ];
            }

            clearGrid() {
                this.grid = Array(this.size).fill().map(() => Array(this.size).fill(''));
                this.placedWords = [];
            }

            canPlaceWord(word, row, col, direction) {
                const [dr, dc] = direction;
                for (let i = 0; i < word.length; i++) {
                    const newRow = row + i * dr;
                    const newCol = col + i * dc;
                    
                    if (newRow < 0 || newRow >= this.size || newCol < 0 || newCol >= this.size) {
                        return false;
                    }
                    
                    if (this.grid[newRow][newCol] !== '' && this.grid[newRow][newCol] !== word[i]) {
                        return false;
                    }
                }
                return true;
            }

            placeWord(word, row, col, direction) {
                const [dr, dc] = direction;
                const positions = [];
                
                for (let i = 0; i < word.length; i++) {
                    const newRow = row + i * dr;
                    const newCol = col + i * dc;
                    this.grid[newRow][newCol] = word[i];
                    positions.push([newRow, newCol]);
                }
                
                this.placedWords.push({
                    word: word,
                    positions: positions,
                    direction: direction,
                    start: [row, col]
                });
                
                return true;
            }

            tryPlaceWord(word, maxAttempts = 200) {
                for (let attempt = 0; attempt < maxAttempts; attempt++) {
                    const row = Math.floor(Math.random() * this.size);
                    const col = Math.floor(Math.random() * this.size);
                    const direction = this.directions[Math.floor(Math.random() * this.directions.length)];
                    
                    if (this.canPlaceWord(word, row, col, direction)) {
                        return this.placeWord(word, row, col, direction);
                    }
                }
                return false;
            }

            fillEmptySpaces() {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZÑ';
                for (let i = 0; i < this.size; i++) {
                    for (let j = 0; j < this.size; j++) {
                        if (this.grid[i][j] === '') {
                            this.grid[i][j] = letters[Math.floor(Math.random() * letters.length)];
                        }
                    }
                }
            }

            generate(words) {
                this.clearGrid();
                const successful = [];
                const failed = [];
                
                const sortedWords = words.sort((a, b) => b.length - a.length);
                
                for (const word of sortedWords) {
                    if (this.tryPlaceWord(word.toUpperCase())) {
                        successful.push(word);
                    } else {
                        failed.push(word);
                    }
                }
                
                this.fillEmptySpaces();
                return { successful, failed };
            }

            drawPuzzle(canvas) {
                const ctx = canvas.getContext('2d');
                const cellSize = 35;
                const margin = 60;
                const listWidth = 350;
                
                canvas.width = this.size * cellSize + 2 * margin + listWidth;
                canvas.height = this.size * cellSize + 2 * margin;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#1e293b';
                ctx.font = '600 22px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('SOPA DE LETRAS', canvas.width / 2, 35);
                
                for (let i = 0; i < this.size; i++) {
                    for (let j = 0; j < this.size; j++) {
                        const x = margin + j * cellSize;
                        const y = margin + i * cellSize;
                        
                        ctx.fillStyle = (i + j) % 2 === 0 ? '#f8fafc' : '#f1f5f9';
                        ctx.fillRect(x, y, cellSize, cellSize);
                        
                        ctx.strokeStyle = '#cbd5e1';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(x, y, cellSize, cellSize);
                        
                        ctx.fillStyle = '#1e293b';
                        ctx.font = '600 16px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(this.grid[i][j], x + cellSize / 2, y + cellSize / 2);
                    }
                }
                
                const xList = this.size * cellSize + margin + 30;
                let yList = margin + 20;
                
                ctx.strokeStyle = '#cbd5e1';
                ctx.lineWidth = 2;
                ctx.strokeRect(xList - 10, yList - 10, listWidth - 40, canvas.height - 2 * margin);
                ctx.fillStyle = '#f8fafc';
                ctx.fillRect(xList - 10, yList - 10, listWidth - 40, canvas.height - 2 * margin);
                
                ctx.fillStyle = '#1e293b';
                ctx.font = '600 16px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                ctx.textAlign = 'left';
                ctx.fillText('PALABRAS A ENCONTRAR', xList, yList);
                yList += 35;
                
                ctx.font = '500 14px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                const words = this.placedWords.map(w => w.word);
                const mid = Math.ceil(words.length / 2);
                
                for (let i = 0; i < mid; i++) {
                    ctx.fillText(`• ${words[i]}`, xList, yList + i * 25);
                }
                
                if (words.length > mid) {
                    for (let i = mid; i < words.length; i++) {
                        ctx.fillText(`• ${words[i]}`, xList + 150, yList + (i - mid) * 25);
                    }
                }
            }

            drawSolution(canvas) {
                const ctx = canvas.getContext('2d');
                const cellSize = 35;
                const margin = 60;
                const listWidth = 350;
                
                canvas.width = this.size * cellSize + 2 * margin + listWidth;
                canvas.height = this.size * cellSize + 2 * margin;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#dc2626';
                ctx.font = '600 22px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('SOPA DE LETRAS - SOLUCIÓN', canvas.width / 2, 35);
                
                const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', 
                               '#ec4899', '#14b8a6', '#f97316', '#6366f1', '#84cc16'];
                
                const wordPositions = new Set();
                this.placedWords.forEach(word => {
                    word.positions.forEach(pos => {
                        wordPositions.add(`${pos[0]},${pos[1]}`);
                    });
                });
                
                for (let i = 0; i < this.size; i++) {
                    for (let j = 0; j < this.size; j++) {
                        if (!wordPositions.has(`${i},${j}`)) {
                            const x = margin + j * cellSize;
                            const y = margin + i * cellSize;
                            
                            ctx.fillStyle = '#f1f5f9';
                            ctx.fillRect(x, y, cellSize, cellSize);
                            
                            ctx.strokeStyle = '#e2e8f0';
                            ctx.lineWidth = 1;
                            ctx.strokeRect(x, y, cellSize, cellSize);
                            
                            ctx.fillStyle = '#cbd5e1';
                            ctx.font = '600 16px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(this.grid[i][j], x + cellSize / 2, y + cellSize / 2);
                        }
                    }
                }
                
                this.placedWords.forEach((wordInfo, idx) => {
                    const color = colors[idx % colors.length];
                    
                    wordInfo.positions.forEach(pos => {
                        const [i, j] = pos;
                        const x = margin + j * cellSize;
                        const y = margin + i * cellSize;
                        
                        ctx.fillStyle = color;
                        ctx.fillRect(x, y, cellSize, cellSize);
                        
                        ctx.strokeStyle = '#1e293b';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(x, y, cellSize, cellSize);
                        
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '600 16px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(this.grid[i][j], x + cellSize / 2, y + cellSize / 2);
                    });
                });
                
                const xList = this.size * cellSize + margin + 30;
                let yList = margin + 20;
                
                ctx.strokeStyle = '#cbd5e1';
                ctx.lineWidth = 2;
                ctx.strokeRect(xList - 10, yList - 10, listWidth - 40, canvas.height - 2 * margin);
                ctx.fillStyle = '#fef2f2';
                ctx.fillRect(xList - 10, yList - 10, listWidth - 40, canvas.height - 2 * margin);
                
                ctx.fillStyle = '#1e293b';
                ctx.font = '600 16px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                ctx.textAlign = 'left';
                ctx.fillText('PALABRAS ENCONTRADAS', xList, yList);
                yList += 35;
                
                const dirSymbols = {
                    '0,1': '→', '1,0': '↓', '1,1': '↘',
                    '0,-1': '←', '-1,0': '↑', '-1,-1': '↖',
                    '1,-1': '↙', '-1,1': '↗'
                };
                
                this.placedWords.forEach((wordInfo, idx) => {
                    const color = colors[idx % colors.length];
                    const dirKey = `${wordInfo.direction[0]},${wordInfo.direction[1]}`;
                    const symbol = dirSymbols[dirKey] || '→';
                    
                    ctx.fillStyle = color;
                    ctx.fillRect(xList, yList, 15, 15);
                    ctx.strokeStyle = '#1e293b';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(xList, yList, 15, 15);
                    
                    ctx.fillStyle = '#1e293b';
                    ctx.font = '500 14px -apple-system, BlinkMacSystemFont, "Segoe UI"';
                    ctx.fillText(`${wordInfo.word} ${symbol}`, xList + 20, yList + 12);
                    
                    yList += 25;
                });
            }
        }

        let generator = null;
        let puzzleCanvas = null;
        let solutionCanvas = null;
        let currentTab = 'puzzle';

        const gridSizeInput = document.getElementById('gridSize');
        const wordListInput = document.getElementById('wordList');
        const wordCountDiv = document.getElementById('wordCount');
        const generateBtn = document.getElementById('generateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const messageBox = document.getElementById('messageBox');
        const canvasContainer = document.getElementById('canvasContainer');
        const downloadButtons = document.getElementById('downloadButtons');
        const downloadPuzzleBtn = document.getElementById('downloadPuzzle');
        const downloadSolutionBtn = document.getElementById('downloadSolution');
        const tabs = document.querySelectorAll('.tab');

        function updateWordCount() {
            const words = wordListInput.value.split('\n').filter(w => w.trim());
            wordCountDiv.textContent = `${words.length} palabra${words.length !== 1 ? 's' : ''}`;
        }

        function showMessage(message, type = 'success') {
            const className = type === 'success' ? 'success-message' : 'warning-message';
            messageBox.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function switchTab(tabName) {
            currentTab = tabName;
            tabs.forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            if (puzzleCanvas && solutionCanvas) {
                canvasContainer.innerHTML = '';
                canvasContainer.appendChild(tabName === 'puzzle' ? puzzleCanvas : solutionCanvas);
            }
        }

        function generate() {
            const size = parseInt(gridSizeInput.value);
            const words = wordListInput.value.split('\n')
                .map(w => w.trim())
                .filter(w => w);
            
            if (words.length === 0) {
                alert('Por favor ingrese al menos una palabra');
                return;
            }
            
            const tooLong = words.filter(w => w.length > size);
            if (tooLong.length > 0) {
                const maxLen = Math.max(...words.map(w => w.length));
                const newSize = Math.min(maxLen + 5, 30);
                
                if (confirm(`Algunas palabras son muy largas:\n${tooLong.join(', ')}\n\n¿Aumentar la grilla a ${newSize}x${newSize}?`)) {
                    gridSizeInput.value = newSize;
                    generate();
                    return;
                } else {
                    return;
                }
            }
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generando...';
            
            setTimeout(() => {
                generator = new WordSearchGenerator(size);
                const result = generator.generate(words);
                
                puzzleCanvas = document.createElement('canvas');
                solutionCanvas = document.createElement('canvas');
                
                generator.drawPuzzle(puzzleCanvas);
                generator.drawSolution(solutionCanvas);
                
                canvasContainer.innerHTML = '';
                canvasContainer.appendChild(currentTab === 'puzzle' ? puzzleCanvas : solutionCanvas);
                downloadButtons.style.display = 'block';
                
                let msg = `Sopa generada exitosamente.<br>`;
                msg += `Palabras colocadas: ${result.successful.length}/${words.length}<br>`;
                msg += `Tamaño: ${size}x${size}`;
                
                if (result.failed.length > 0) {
                    msg += `<br><br>No se pudieron colocar: ${result.failed.join(', ')}`;
                    showMessage(msg, 'warning');
                } else {
                    showMessage(msg, 'success');
                }
                
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generar Sopa de Letras';
            }, 100);
        }

        function downloadCanvas(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        wordListInput.addEventListener('input', updateWordCount);
        generateBtn.addEventListener('click', generate);
        clearBtn.addEventListener('click', () => {
            wordListInput.value = '';
            updateWordCount();
            canvasContainer.innerHTML = '<div class="empty-state"><h3>Configure y genere su sopa de letras</h3><p>Las imágenes aparecerán aquí y podrá descargarlas</p></div>';
            downloadButtons.style.display = 'none';
            messageBox.innerHTML = '';
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });

        downloadPuzzleBtn.addEventListener('click', () => {
            downloadCanvas(puzzleCanvas, 'sopa_de_letras.png');
        });

        downloadSolutionBtn.addEventListener('click', () => {
            downloadCanvas(solutionCanvas, 'sopa_de_letras_solucion.png');
        });

        updateWordCount();
    </script>
</body>
</html>
